#!/usr/bin/env ruby
# chsh

# 20210728
# 0.0.0

require 'FileUtils/where'
require 'readline'

def system_chsh
  FileUtils.where('chsh').last
end

def list_of_shells
  `cat /etc/shells`.split("\n")
    .reject{|line| line =~ /^#/ || line == ''}
    .map{|line| line.sub(/\/bin\//, '')}
end

def run_menu
  list_of_shells.each_with_index do |shell, index|
    puts "#{index}. #{shell}"
  end
  menu_number = Readline.readline('Shell #: ').to_i
  selection = list_of_shells[menu_number]
  chsh(selection)
end

def chsh(shell)
  system("#{system_chsh} -s /bin/#{shell}")
end

def main
  if ARGV[0]
    chsh(ARGV[0])
  else
    run_menu
  end
end

main
